[env:feather_esp32s3]
platform = espressif32
board = adafruit_feather_esp32s3_nopsram
framework = arduino
monitor_speed = 115200
board_build.filesystem = fatfs
board_build.partitions = partitions-8MB-tinyuf2.csv
build_flags = -DARDUINO_USB_MODE=1
extra_scripts = pre:scripts/patch_tm1638.py

; Upload Configuration - OTA
; Set OTA_PASSWORD env var, or create platformio_override.ini with:
;   [env:feather_esp32s3]
;   upload_flags = --auth=your-password
upload_protocol = espota
upload_port = esp32-smoker.local
upload_flags =
    --auth=${sysenv.OTA_PASSWORD}

lib_deps =
    ; Core libraries
    bblanchon/ArduinoJson @ ^6.20.0

    ; Web Server (from GitHub)
    https://github.com/me-no-dev/ESPAsyncWebServer.git
    https://github.com/me-no-dev/AsyncTCP.git

    ; MQTT
    knolleary/PubSubClient @ ^2.8

    ; TM1638 Display
    https://github.com/rjbatista/tm1638-library.git

    ; Syslog
    arcao/Syslog @ ^2.0.0

    ; Telnet Server for remote serial access
    https://github.com/LennartHennigs/ESPTelnet.git

; ============================================================================
; Native test environment (runs on host machine, no ESP32 needed)
; Usage: pio test -e native
; ============================================================================
[env:native]
platform = native
test_framework = unity
test_build_src = true
build_flags =
    -DUNIT_TEST
    -DBOOT_GRACE_PERIOD_MS=0
    -std=c++14
build_src_filter =
    +<temperature_control.cpp>
    +<relay_control.cpp>
lib_extra_dirs = test/lib
lib_deps =
    throwtheswitch/Unity @ ^2.6.1
lib_ldf_mode = deep
test_filter = test_*
